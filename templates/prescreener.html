<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="stylesheet" href="{{ url_for('static', filename='custom-styles.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='uswds-2.4.0/css/uswds.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='uswds-2.4.0/css/uswds.min.css.map') }}">
    <link href="https://fonts.googleapis.com/css?family=Merriweather&display=swap" rel="stylesheet">
    <meta name="viewport" content="width=device-width">
    <meta name="robots" content="noindex" />
  </head>
  <style>
  </style>
  <body>
    <div class="alert">
      This is a demonstration website only.
      Do not enter any private or personal data.
    </div>
    <div class="grid-container margin-y-5">
      <div class="grid-row grid-gap-lg">
        <div class="tablet:grid-col-6">
          <h1>Could you be eligible for help with your food budget?</h1>
          <form id="prescreener-form" class="usa-form">
            <em>Answer a few questions to find out if you may be eligible and how many dollars per month you may qualify for.</em>
            <fieldset class="usa-fieldset">
              <label class="usa-label" for="state_or_territory">State:</label>
              <select required class="usa-select" id="state_or_territory" name="state_or_territory">
                <option value>- Select -</option>
                <!-- <option value="AL">Alabama</option>
                <option value="AK">Alaska</option>
                <option value="AZ">Arizona</option>
                <option value="AR">Arkansas</option>
                <option value="CA">California</option>
                <option value="CO">Colorado</option>
                <option value="CT">Connecticut</option>
                <option value="DE">Delaware</option>
                <option value="DC">District of Columbia</option>
                <option value="FL">Florida</option>
                <option value="GA">Georgia</option>
                <option value="HI">Hawaii</option>
                <option value="ID">Idaho</option> -->
                <option value="IL">Illinois</option>
                <!-- <option value="IN">Indiana</option>
                <option value="IA">Iowa</option>
                <option value="KS">Kansas</option>
                <option value="KY">Kentucky</option>
                <option value="LA">Louisiana</option>
                <option value="ME">Maine</option>
                <option value="MD">Maryland</option>
                <option value="MA">Massachusetts</option>
                <option value="MI">Michigan</option>
                <option value="MN">Minnesota</option>
                <option value="MS">Mississippi</option>
                <option value="MO">Missouri</option>
                <option value="MT">Montana</option>
                <option value="NE">Nebraska</option>
                <option value="NV">Nevada</option>
                <option value="NH">New Hampshire</option>
                <option value="NJ">New Jersey</option>
                <option value="NM">New Mexico</option>
                <option value="NY">New York</option>
                <option value="NC">North Carolina</option>
                <option value="ND">North Dakota</option>
                <option value="OH">Ohio</option>
                <option value="OK">Oklahoma</option>
                <option value="OR">Oregon</option>
                <option value="PA">Pennsylvania</option>
                <option value="RI">Rhode Island</option>
                <option value="SC">South Carolina</option>
                <option value="SD">South Dakota</option>
                <option value="TN">Tennessee</option>
                <option value="TX">Texas</option>
              -->
                <option value="UT">Utah</option>
                <option value="VT">Vermont</option>
                <!--
                <option value="VA">Virginia</option>
                <option value="WA">Washington</option>
                <option value="WV">West Virginia</option>
                <option value="WI">Wisconsin</option>
                <option value="WY">Wyoming</option> -->
              </select>

              <label class="usa-label" for="household_size">Household size:</label>
              <select required class="usa-select" id="household_size" name="household_size">
                <option value>- Select -</option>
                <option value="1">Just me</option>
                <option value="2">2 people</option>
                <option value="3">3 people</option>
                <option value="4">4 people</option>
                <option value="5">5 people</option>
                <option value="6">6 people</option>
                <option value="7">7 people</option>
                <option value="8">8 people</option>
                <option value="9">9 people</option>
                <option value="10">10 people</option>
              </select>

              <label class="usa-label" for="monthly_job_income">
                Monthly income from a job or from self-employment:
              </label>
              <input id="monthly_job_income"
                     name="monthly_job_income"
                     class="usa-input"
                     required />

              <label class="usa-label" for="monthly_non_job_income">
                Monthly income from other sources:
              </label>
              <em class="label-sub-text">
                (These could include: Social Security, disability, Child Support, Worker's Comp, Unemployment, Pension Income, or other sources of income.)
              </em>
              <input id="monthly_non_job_income"
                     name="monthly_non_job_income"
                     class="usa-input"
                     required />

              <label class="usa-label" for="resources">
                Total assets:
              </label>
              <input id="resources"
                     name="resources"
                     class="usa-input"
                     required />

              <label class="usa-label" for="dependent_care_costs">
                Dependent care costs:
              </label>
              <input id="dependent_care_costs"
                     name="dependent_care_costs"
                     class="usa-input" />
              <br/>

              <fieldset class="usa-fieldset">
                <legend>Does household include someone who is 60 or older, or someone who is disabled?</legend>
                <div class="usa-radio">
                  <input class="usa-radio__input"
                         id="input__household_includes_elderly_or_disabled_true"
                         type="radio"
                         name="household_includes_elderly_or_disabled"
                         value="true">
                  <label id="label__household_includes_elderly_or_disabled_true"
                         class="usa-radio__label"
                         for="input__household_includes_elderly_or_disabled_true">
                    Yes
                  </label>
                </div>
                <div class="usa-radio">
                  <input class="usa-radio__input"
                         id="input__household_includes_elderly_or_disabled_false"
                         type="radio"
                         name="household_includes_elderly_or_disabled"
                         value="false">
                  <label id="label__household_includes_elderly_or_disabled_false"
                         class="usa-radio__label"
                         for="input__household_includes_elderly_or_disabled_false">
                    No
                  </label>
                </div>
              </fieldset>

              <div id="medical_expenses_for_elderly_or_disabled_question" class="hidden">
                <label class="usa-label" for="medical_expenses_for_elderly_or_disabled">
                  Monthly out of pocket medical expenses for household members who are age 60 or older or disabled:
                </label>
                <input id="medical_expenses_for_elderly_or_disabled"
                       name="medical_expenses_for_elderly_or_disabled"
                       class="usa-input" />
              </div>

              <label class="usa-label" for="court_ordered_child_support_payments">
                Monthly court-ordered child support payments:
              </label>
              <input id="court_ordered_child_support_payments"
                     name="court_ordered_child_support_payments"
                     class="usa-input" />

              <label class="usa-label" for="rent_or_mortgage">
                Monthly rent or mortgage amount:
              </label>
              <input id="rent_or_mortgage"
                    name="rent_or_mortgage"
                    class="usa-input" />

              <label class="usa-label" for="homeowners_insurance_and_taxes">
                Monthly homeowners insurance and taxes:
              </label>
              <input id="homeowners_insurance_and_taxes"
                   name="homeowners_insurance_and_taxes"
                   class="usa-input" />

              <input id="prescreener-form-submit"
                     class="usa-button"
                     type="submit"
                     value="Submit">
            </fieldset>
          </form>
        </div>
        <div class="tablet:grid-col-6" id="results">
        </div>
      </div>
    </div>
  </body>
  <script type="text/javascript">
      function toggleReasons () {
          var reasons = document.getElementById('reasons');
          var why = document.getElementById('why');

          if (reasons) {
              reasons.classList.toggle('hidden');
          }
          if (why) {
              why.classList.toggle('hidden');
          }
      }

      function showMedicalExpensesForElderlyOrDisabled () {
          var elem = document.getElementById('medical_expenses_for_elderly_or_disabled_question');

          if (elem) {
              if (elem.classList.contains('hidden')) {
                  elem.classList.remove('hidden');
              }
          }
      }

      function hideMedicalExpensesForElderlyOrDisabled () {
          var elem = document.getElementById('medical_expenses_for_elderly_or_disabled_question');

          if (elem) {
              if (!elem.classList.contains('hidden')) {
                  elem.classList.add('hidden');
              }
          }
      }

      function responseToHTML (response) {
          if (response.status !== 'OK') {
            html = '<h1>Error(s):</h1>';
            errors = response.errors;

            for (var i = 0; i < errors.length; i++) {
                var error = errors[i];
                html += ('<li style="color: red;">' + error + '.</li>')
            }

            window.scrollTo(0, 0);
            return html;
          }

          html = '<h1>Results:</h1>';

          if (response.eligible) {
              html += '<div class="result-headline">You may be <b>eligible</b> for SNAP benefits.</div>';
              html += '<div class="result-headline">Your benefit could be as much as $' + response.estimated_monthly_benefit + ' per month.</div>';
              html += '<div class="result-headline">Apply here: <a href="' + response.state_website + '">' + response.state_website + '</a>.</div>';
          } else {
              html += '<div class="result-headline">You may not be eligible for SNAP benefits.</div>'
          }

          html += '<br/><a class="result-headline why" id="why" onclick="toggleReasons()">Why did I get these results?</a>';

          html += '<div id="reasons" class="hidden">';

          var eligibility_factors = response.eligibility_factors;
          eligibility_factors.sort(function(a, b) {
              return a.sort_order - b.sort_order;
          });

          console.log('eligibility_factors', eligibility_factors)

          for (var i = 0; i < eligibility_factors.length; i++) {
              var eligibility_factor = eligibility_factors[i];
              name = eligibility_factor.name
              explanation = eligibility_factor.explanation

              html += ('<h3>' + name + ':</h3>')

              html += '<div>';
              for (var j = 0; j < explanation.length; j++) {
                  var explanation_graph = explanation[j];
                  html += ('<p>' + explanation_graph + '</p>')
              }
              html += '</div>';
          }
          html += '</div>';

          window.scrollTo(0, 0);
          return html;
      }

      function sendData() {
          var XHR = new XMLHttpRequest();

          // Define what happens on successful data submission.
          XHR.addEventListener("load", function(event) {
              response = JSON.parse(event.target.responseText);
              resultHTML = responseToHTML(response);

              var results = document.getElementById('results');
              results.innerHTML = resultHTML;
          });

          // Define what happens in case of error.
          XHR.addEventListener("error", function( event ) {
            console.log('Oops! Something went wrong.');
          });

          // Set up our request.
          XHR.open("POST", "/calculate");
          XHR.setRequestHeader("Content-Type", "application/json;charset=UTF-8");

          // Send form data as JSON.
          var formData = new FormData(form);
          var jsonData = {};
          formData.forEach(function(value, key) {
              jsonData[key] = value;
          });
          var json = JSON.stringify(jsonData);

          XHR.send(json);
      }

      var form = document.getElementById('prescreener-form');

      form.addEventListener('submit', function (event) {
          event.preventDefault();
          sendData();
      });

      var elderlyOrDisabledTrue = document.getElementById('input__household_includes_elderly_or_disabled_true');
      var elderlyOrDisabledFalse = document.getElementById('input__household_includes_elderly_or_disabled_false');

      elderlyOrDisabledTrue.addEventListener('change', function (event) {
          showMedicalExpensesForElderlyOrDisabled();
      });

      elderlyOrDisabledFalse.addEventListener('change', function (event) {
          hideMedicalExpensesForElderlyOrDisabled();
      });
  </script>
</html>
